import yahooFinance from "yahoo-finance2";
import moment from "moment";
import { NextResponse } from "next/server";

// const result = [
//   {
//     date: "2025-06-27T03:00:00.000Z",
//     high: 1104.9200439453125,
//     volume: 3428400,
//     open: 1104.6800537109375,
//     low: 1078.5699462890625,
//     close: 1082.4200439453125,
//     adjClose: 1082.4200439453125,
//   },
//   {
//     date: "2025-06-30T03:00:00.000Z",
//     high: 1094.77001953125,
//     volume: 7904000,
//     open: 1089.010009765625,
//     low: 1080.9200439453125,
//     close: 1089.56005859375,
//     adjClose: 1089.56005859375,
//   },
//   {
//     date: "2025-07-01T03:00:00.000Z",
//     high: 1110.010009765625,
//     volume: 3109100,
//     open: 1094.9100341796875,
//     low: 1086.56005859375,
//     close: 1110.010009765625,
//     adjClose: 1110.010009765625,
//   },
//   {
//     date: "2025-07-02T03:00:00.000Z",
//     high: 1115.68994140625,
//     volume: 2811300,
//     open: 1107.1300048828125,
//     low: 1103.989990234375,
//     close: 1115.68994140625,
//     adjClose: 1115.68994140625,
//   },
//   {
//     date: "2025-07-03T03:00:00.000Z",
//     high: 1127.6600341796875,
//     volume: 3356100,
//     open: 1114.8299560546875,
//     low: 1113.77001953125,
//     close: 1127.2099609375,
//     adjClose: 1127.2099609375,
//   },
//   {
//     date: "2025-07-04T03:00:00.000Z",
//     high: 1128.0799560546875,
//     volume: 2861300,
//     open: 1127.3499755859375,
//     low: 1115.3699951171875,
//     close: 1119.93994140625,
//     adjClose: 1119.93994140625,
//   },
//   {
//     date: "2025-07-07T03:00:00.000Z",
//     high: 1123,
//     volume: 3664700,
//     open: 1113.3599853515625,
//     low: 1107.4599609375,
//     close: 1123,
//     adjClose: 1123,
//   },
//   {
//     date: "2025-07-08T03:00:00.000Z",
//     high: 1121.3699951171875,
//     volume: 2651600,
//     open: 1112.3900146484375,
//     low: 1110.1600341796875,
//     close: 1115.6500244140625,
//     adjClose: 1115.6500244140625,
//   },
//   {
//     date: "2025-07-09T03:00:00.000Z",
//     high: 1120.449951171875,
//     volume: 2712500,
//     open: 1115.5799560546875,
//     low: 1108.0899658203125,
//     close: 1110.4000244140625,
//     adjClose: 1110.4000244140625,
//   },
//   {
//     date: "2025-07-11T03:00:00.000Z",
//     high: 1130.280029296875,
//     volume: 2364100,
//     open: 1116.6099853515625,
//     low: 1115.469970703125,
//     close: 1121.1300048828125,
//     adjClose: 1121.1300048828125,
//   },
//   {
//     date: "2025-07-14T03:00:00.000Z",
//     high: 1143.31005859375,
//     volume: 3173400,
//     open: 1122.3900146484375,
//     low: 1121.6400146484375,
//     close: 1143.31005859375,
//     adjClose: 1143.31005859375,
//   },
//   {
//     date: "2025-07-15T03:00:00.000Z",
//     high: 1162.719970703125,
//     volume: 4165700,
//     open: 1143.72998046875,
//     low: 1139.6400146484375,
//     close: 1161.010009765625,
//     adjClose: 1161.010009765625,
//   },
//   {
//     date: "2025-07-16T03:00:00.000Z",
//     high: 1167.800048828125,
//     volume: 4316500,
//     open: 1160.1400146484375,
//     low: 1154.1300048828125,
//     close: 1157.6300048828125,
//     adjClose: 1157.6300048828125,
//   },
//   {
//     date: "2025-07-17T03:00:00.000Z",
//     high: 1199.1400146484375,
//     volume: 4464500,
//     open: 1163.9000244140625,
//     low: 1162.699951171875,
//     close: 1198.1099853515625,
//     adjClose: 1198.1099853515625,
//   },
//   {
//     date: "2025-07-18T03:00:00.000Z",
//     high: 1210.010009765625,
//     volume: 4248300,
//     open: 1197.3599853515625,
//     low: 1195.300048828125,
//     close: 1206.5799560546875,
//     adjClose: 1206.5799560546875,
//   },
//   {
//     date: "2025-07-21T03:00:00.000Z",
//     high: 1217.8299560546875,
//     volume: 3394400,
//     open: 1213.52001953125,
//     low: 1199.5400390625,
//     close: 1208.1300048828125,
//     adjClose: 1208.1300048828125,
//   },
//   {
//     date: "2025-07-22T03:00:00.000Z",
//     high: 1213.239990234375,
//     volume: 3928900,
//     open: 1209.5699462890625,
//     low: 1191.6500244140625,
//     close: 1191.75,
//     adjClose: 1191.75,
//   },
//   {
//     date: "2025-07-23T03:00:00.000Z",
//     high: 1222.75,
//     volume: 3860500,
//     open: 1202.8199462890625,
//     low: 1202.25,
//     close: 1219.6199951171875,
//     adjClose: 1219.6199951171875,
//   },
//   {
//     date: "2025-07-24T03:00:00.000Z",
//     high: 1227.7099609375,
//     volume: 3626100,
//     open: 1214.2900390625,
//     low: 1206.18994140625,
//     close: 1212.489990234375,
//     adjClose: 1212.489990234375,
//   },
//   {
//     date: "2025-07-25T03:00:00.000Z",
//     high: 1218.7099609375,
//     volume: 2721100,
//     open: 1205.25,
//     low: 1204.699951171875,
//     close: 1217.1500244140625,
//     adjClose: 1217.1500244140625,
//   },
//   {
//     date: "2025-07-29T03:00:00.000Z",
//     high: 1235.18994140625,
//     volume: 3425200,
//     open: 1224.27001953125,
//     low: 1213.8699951171875,
//     close: 1233.6800537109375,
//     adjClose: 1233.6800537109375,
//   },
//   {
//     date: "2025-07-30T03:00:00.000Z",
//     high: 1245.43994140625,
//     volume: 4528600,
//     open: 1236.010009765625,
//     low: 1234.2099609375,
//     close: 1244.1400146484375,
//     adjClose: 1244.1400146484375,
//   },
//   {
//     date: "2025-07-31T03:00:00.000Z",
//     high: 1251.1600341796875,
//     volume: 4009900,
//     open: 1241.7900390625,
//     low: 1229.760009765625,
//     close: 1242.3499755859375,
//     adjClose: 1242.3499755859375,
//   },
//   {
//     date: "2025-08-01T03:00:00.000Z",
//     high: 1255.3900146484375,
//     volume: 4796000,
//     open: 1252.5,
//     low: 1217.3699951171875,
//     close: 1218.3299560546875,
//     adjClose: 1218.3299560546875,
//   },
//   {
//     date: "2025-08-04T03:00:00.000Z",
//     high: 1231.1099853515625,
//     volume: 3153600,
//     open: 1222.5799560546875,
//     low: 1212.6800537109375,
//     close: 1229.4000244140625,
//     adjClose: 1229.4000244140625,
//   },
//   {
//     date: "2025-08-05T03:00:00.000Z",
//     high: 1250.3599853515625,
//     volume: 4058800,
//     open: 1235.1300048828125,
//     low: 1233.43994140625,
//     close: 1246.9599609375,
//     adjClose: 1246.9599609375,
//   },
//   {
//     date: "2025-08-06T03:00:00.000Z",
//     high: 1266.52001953125,
//     volume: 5670100,
//     open: 1253.8499755859375,
//     low: 1248.0899658203125,
//     close: 1264.469970703125,
//     adjClose: 1264.469970703125,
//   },
//   {
//     date: "2025-08-07T03:00:00.000Z",
//     high: 1280.780029296875,
//     volume: 5528300,
//     open: 1270.43994140625,
//     low: 1260.31005859375,
//     close: 1265.1500244140625,
//     adjClose: 1265.1500244140625,
//   },
//   {
//     date: "2025-08-08T03:00:00.000Z",
//     high: 1266.010009765625,
//     volume: 4359000,
//     open: 1260.47998046875,
//     low: 1253.239990234375,
//     close: 1259.0699462890625,
//     adjClose: 1259.0699462890625,
//   },
//   {
//     date: "2025-08-13T03:00:00.000Z",
//     high: 1280.1600341796875,
//     volume: 5198500,
//     open: 1270.550048828125,
//     low: 1263.9300537109375,
//     close: 1277.4300537109375,
//     adjClose: 1277.4300537109375,
//   },
//   {
//     date: "2025-08-14T03:00:00.000Z",
//     high: 1283.550048828125,
//     volume: 4744300,
//     open: 1277.0899658203125,
//     low: 1266.050048828125,
//     close: 1266.6700439453125,
//     adjClose: 1266.6700439453125,
//   },
//   {
//     date: "2025-08-15T03:00:00.000Z",
//     high: 1270.8900146484375,
//     volume: 4432500,
//     open: 1268.8800048828125,
//     low: 1253.510009765625,
//     close: 1259.4200439453125,
//     adjClose: 1259.4200439453125,
//   },
//   {
//     date: "2025-08-18T03:00:00.000Z",
//     high: 1260.22998046875,
//     volume: 3479100,
//     open: 1260.22998046875,
//     low: 1242.31005859375,
//     close: 1242.31005859375,
//     adjClose: 1242.31005859375,
//   },
//   {
//     date: "2025-08-19T03:00:00.000Z",
//     high: 1248.4000244140625,
//     volume: 3308400,
//     open: 1238.8499755859375,
//     low: 1235.760009765625,
//     close: 1235.760009765625,
//     adjClose: 1235.760009765625,
//   },
//   {
//     date: "2025-08-20T03:00:00.000Z",
//     high: 1251.1400146484375,
//     volume: 3841400,
//     open: 1234.489990234375,
//     low: 1228.4300537109375,
//     close: 1248.1300048828125,
//     adjClose: 1248.1300048828125,
//   },
//   {
//     date: "2025-08-21T03:00:00.000Z",
//     high: 1254.52001953125,
//     volume: 4098900,
//     open: 1252.6099853515625,
//     low: 1243.530029296875,
//     close: 1244.7900390625,
//     adjClose: 1244.7900390625,
//   },
//   {
//     date: "2025-08-22T03:00:00.000Z",
//     high: 1257.989990234375,
//     volume: 3186500,
//     open: 1247.25,
//     low: 1245.300048828125,
//     close: 1253.3900146484375,
//     adjClose: 1253.3900146484375,
//   },
//   {
//     date: "2025-08-25T03:00:00.000Z",
//     high: 1268.1300048828125,
//     volume: 3288600,
//     open: 1264.68994140625,
//     low: 1260.760009765625,
//     close: 1262.6700439453125,
//     adjClose: 1262.6700439453125,
//   },
//   {
//     date: "2025-08-26T03:00:00.000Z",
//     high: 1262.9300537109375,
//     volume: 4758300,
//     open: 1255.949951171875,
//     low: 1249.449951171875,
//     close: 1251.260009765625,
//     adjClose: 1251.260009765625,
//   },
//   {
//     date: "2025-08-27T03:00:00.000Z",
//     high: 1260.75,
//     volume: 3144200,
//     open: 1253.4100341796875,
//     low: 1246.8599853515625,
//     close: 1248.030029296875,
//     adjClose: 1248.030029296875,
//   },
//   {
//     date: "2025-08-28T03:00:00.000Z",
//     high: 1255.43994140625,
//     volume: 3094000,
//     open: 1247.760009765625,
//     low: 1246,
//     close: 1250.0899658203125,
//     adjClose: 1250.0899658203125,
//   },
//   {
//     date: "2025-08-29T03:00:00.000Z",
//     high: 1255.8399658203125,
//     volume: 4142500,
//     open: 1248.3199462890625,
//     low: 1236.6099853515625,
//     close: 1236.6099853515625,
//     adjClose: 1236.6099853515625,
//   },
//   {
//     date: "2025-09-01T03:00:00.000Z",
//     high: 1246.5799560546875,
//     volume: 7450600,
//     open: 1234.93994140625,
//     low: 1230.550048828125,
//     close: 1244.47998046875,
//     adjClose: 1244.47998046875,
//   },
//   {
//     date: "2025-09-02T03:00:00.000Z",
//     high: 1253.5999755859375,
//     volume: 3314200,
//     open: 1248.5899658203125,
//     low: 1243.47998046875,
//     close: 1248.780029296875,
//     adjClose: 1248.780029296875,
//   },
//   {
//     date: "2025-09-03T03:00:00.000Z",
//     high: 1261.8499755859375,
//     volume: 4728000,
//     open: 1250.7900390625,
//     low: 1249.9100341796875,
//     close: 1259.31005859375,
//     adjClose: 1259.31005859375,
//   },
//   {
//     date: "2025-09-04T03:00:00.000Z",
//     high: 1270.739990234375,
//     volume: 4258600,
//     open: 1262.3800048828125,
//     low: 1250.8599853515625,
//     close: 1252.550048828125,
//     adjClose: 1252.550048828125,
//   },
//   {
//     date: "2025-09-05T03:00:00.000Z",
//     high: 1270.31005859375,
//     volume: 5329700,
//     open: 1258.6199951171875,
//     low: 1255.7099609375,
//     close: 1264.800048828125,
//     adjClose: 1264.800048828125,
//   },
//   {
//     date: "2025-09-08T03:00:00.000Z",
//     high: 1276.1500244140625,
//     volume: 4890500,
//     open: 1273.6199951171875,
//     low: 1264.7900390625,
//     close: 1266.1099853515625,
//     adjClose: 1266.1099853515625,
//   },
//   {
//     date: "2025-09-09T03:00:00.000Z",
//     high: 1276.0799560546875,
//     volume: 4699300,
//     open: 1269.31005859375,
//     low: 1266.5799560546875,
//     close: 1276.0799560546875,
//     adjClose: 1276.0799560546875,
//   },
//   {
//     date: "2025-09-10T03:00:00.000Z",
//     high: 1281.18994140625,
//     volume: 4590600,
//     open: 1279.02001953125,
//     low: 1274.3900146484375,
//     close: 1278.050048828125,
//     adjClose: 1278.050048828125,
//   },
//   {
//     date: "2025-09-11T03:00:00.000Z",
//     high: 1291.6400146484375,
//     volume: 4333200,
//     open: 1279.47998046875,
//     low: 1279.47998046875,
//     close: 1288.030029296875,
//     adjClose: 1288.030029296875,
//   },
//   {
//     date: "2025-09-12T03:00:00.000Z",
//     high: 1299.18994140625,
//     volume: 3602100,
//     open: 1295.43994140625,
//     low: 1289.31005859375,
//     close: 1293.6199951171875,
//     adjClose: 1293.6199951171875,
//   },
//   {
//     date: "2025-09-15T03:00:00.000Z",
//     high: 1300.5999755859375,
//     volume: 3933700,
//     open: 1294.5899658203125,
//     low: 1287.93994140625,
//     close: 1299.780029296875,
//     adjClose: 1299.780029296875,
//   },
//   {
//     date: "2025-09-16T03:00:00.000Z",
//     high: 1309.9000244140625,
//     volume: 4562700,
//     open: 1304.3699951171875,
//     low: 1303.2900390625,
//     close: 1308.18994140625,
//     adjClose: 1308.18994140625,
//   },
//   {
//     date: "2025-09-17T03:00:00.000Z",
//     high: 1311.800048828125,
//     volume: 5327800,
//     open: 1308.72998046875,
//     low: 1304.6700439453125,
//     close: 1306.68994140625,
//     adjClose: 1306.68994140625,
//   },
//   {
//     date: "2025-09-18T03:00:00.000Z",
//     high: 1312.739990234375,
//     volume: 5205300,
//     open: 1312.1500244140625,
//     low: 1292.72998046875,
//     close: 1297.010009765625,
//     adjClose: 1297.010009765625,
//   },
//   {
//     date: "2025-09-19T03:00:00.000Z",
//     high: 1302.489990234375,
//     volume: 4907700,
//     open: 1299.8499755859375,
//     low: 1292.4100341796875,
//     close: 1292.719970703125,
//     adjClose: 1292.719970703125,
//   },
//   {
//     date: "2025-09-22T03:00:00.000Z",
//     high: 1296.4200439453125,
//     volume: 4005200,
//     open: 1294.68994140625,
//     low: 1282.5400390625,
//     close: 1282.5400390625,
//     adjClose: 1282.5400390625,
//   },
//   {
//     date: "2025-09-23T03:00:00.000Z",
//     high: 1290.8399658203125,
//     volume: 4298700,
//     open: 1284.989990234375,
//     low: 1272.6800537109375,
//     close: 1273.199951171875,
//     adjClose: 1273.199951171875,
//   },
//   {
//     date: "2025-09-24T03:00:00.000Z",
//     high: 1282.18994140625,
//     volume: 3551200,
//     open: 1273.5,
//     low: 1268.489990234375,
//     close: 1278.4100341796875,
//     adjClose: 1278.4100341796875,
//   },
//   {
//     date: "2025-09-25T03:00:00.000Z",
//     high: 1289.7099609375,
//     volume: 3132600,
//     open: 1280.7900390625,
//     low: 1279.1099853515625,
//     close: 1288.260009765625,
//     adjClose: 1288.260009765625,
//   },
//   {
//     date: "2025-09-26T09:21:49.000Z",
//     high: 1288.1300048828125,
//     volume: 0,
//     open: 1285.449951171875,
//     low: 1278.199951171875,
//     close: 1280.9599609375,
//     adjClose: 1280.9599609375,
//   },
// ];

export async function GET(req: Request) {
  const { searchParams } = new URL(req.url);
  const stock = searchParams.get("stock");
  const dateValue = searchParams.get("dateValue");

  if (!stock || !dateValue) {
    return NextResponse.json({ error: "Missing parameters" }, { status: 400 });
  }

  const query = stock as string;
  const dayValue = moment(dateValue).subtract(90, "days").format("YYYY-MM-DD");

  const queryOptions = { period1: dayValue };

  try {
    const result = await yahooFinance.historical(query, queryOptions);

    return NextResponse.json(result);
  } catch (error) {
    console.error(error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}
